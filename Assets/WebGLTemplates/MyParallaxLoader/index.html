<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />

    <!-- Title will be filled in by Unity’s templating (e.g. “Netherlands3D | 1.0”) -->
    <title>"Netherlands3D"</title>

    <!-- Your custom CSS (buttons, debug badges, dialogs, etc.) -->
    <link rel="stylesheet" href="style.css?v={{{ PRODUCT_VERSION }}}" />

    <!-- Parallax + loading‐overlay styles shipped by Unity → must live in TemplateData/style.css -->
    <link rel="stylesheet" href="TemplateData/style.css" />

    <!-- MobileDetect.js for detecting phone/tablet -->
    <script src="js/mobile-detect.min.js"></script>
</head>

<body>
    <!-- ─────────────────────────────────────────────────────────────────── -->
    <!-- 1) PARALLAX BACKGROUND (110% oversize)                              -->
    <!-- ─────────────────────────────────────────────────────────────────── -->
    <div id="parallaxContainer">
        <div class="parallax-layer" id="layer-back"></div>
        <div class="parallax-layer" id="layer-mid"></div>
        <div class="parallax-layer" id="layer-front"></div>
    </div>

    <!-- ─────────────────────────────────────────────────────────────────── -->
    <!-- 2) DEBUG PANEL (appears only if “?debug” is in the URL)            -->
    <!-- ─────────────────────────────────────────────────────────────────── -->
    <div id="nl3d-debug">
        <p>
            {{{ PRODUCT_NAME }}} v{{{ PRODUCT_VERSION }}} &middot; Mobile:
            <span id="nl3d-on-mobile" class="debug-badge">Unknown</span>
            &middot; User Agent:
            <span id="nl3d-user-agent" class="debug-badge">Unknown</span>
        </p>
    </div>

    <!-- ─────────────────────────────────────────────────────────────────── -->
    <!-- 3) LOADING OVERLAY (initially visible, covers entire screen)       -->
    <!-- ─────────────────────────────────────────────────────────────────── -->
    <div id="loadingOverlay">
        <div id="overlayContent">
            <!-- Flipbook‐style logo animation (defined in TemplateData/style.css) -->
            <div id="flipbookLogo"></div>

            <!-- Custom progress bar -->
            <div id="progressContainer">
                <div id="progressBar"></div>
            </div>
            <p id="progressPercent">0%</p>
        </div>
    </div>

    <!-- ─────────────────────────────────────────────────────────────────── -->
    <!-- 4) UNITY CANVAS CONTAINER (empty; createUnityInstance will inject a <canvas>) -->
    <!-- ─────────────────────────────────────────────────────────────────── -->
    <div id="unityContainer"></div>

    <!-- ─────────────────────────────────────────────────────────────────── -->
    <!-- 5) MOBILE‐WARNING DIALOG (hidden by default)                       -->
    <!-- ─────────────────────────────────────────────────────────────────── -->
    <div id="unity-mobile-warning" class="dialog">
        <div class="dialog--header">
            <svg viewBox="0 0 22 17"
                 class="dialog--header-icon"
                 fill="none"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M1.07699 14.4335L10.176 1.19861C10.5733 0.620645 11.4267 0.620645 11.824 1.19861L20.923 14.4335C21.3792 15.097 20.9041 16 20.099 16H1.90103C1.09585 16 0.620831 15.097 1.07699 14.4335Z"
                      stroke="currentColor"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round" />
                <rect x="10" y="12.0008" width="2" height="1.81818" fill="currentColor" />
                <rect x="10" y="4.72772" width="2" height="6.36364" fill="currentColor" />
            </svg>
            Waarschuwing mobiele weergave
        </div>
        <div class="paragraph-heading">Let op!</div>
        <p>
            Netherlands 3D is nog niet geoptimaliseerd voor weergave op mobiele apparaten.
            Hierdoor kan het voorkomen dat de applicatie niet optimaal functioneert en kan
            daardoor voor onverwachte resultaten zorgen.
        </p>
        <footer class="dialog--footer">
            <a href="#" onclick="history.back()" class="button" id="nl3d-back-button">
                Terug
            </a>
            <a href="#" onclick="LoadUnity()" class="button">Ok, begrepen</a>
        </footer>
    </div>

    <!-- ─────────────────────────────────────────────────────────────────── -->
    <!-- 6) LOAD‐ERROR DIALOG (hidden by default)                           -->
    <!-- ─────────────────────────────────────────────────────────────────── -->
    <div id="unity-load-error" class="dialog">
        <div class="dialog--header">
            <svg viewBox="0 0 22 17"
                 class="dialog--header-icon"
                 fill="none"
                 xmlns="http://www.w3.org/2000/svg">
                <path d="M1.07699 14.4335L10.176 1.19861C10.5733 0.620645 11.4267 0.620645 11.824 1.19861L20.923 14.4335C21.3792 15.097 20.9041 16 20.099 16H1.90103C1.09585 16 0.620831 15.097 1.07699 14.4335Z"
                      stroke="currentColor"
                      stroke-width="1.5"
                      stroke-linecap="round"
                      stroke-linejoin="round" />
                <rect x="10" y="12.0008" width="2" height="1.81818" fill="currentColor" />
                <rect x="10" y="4.72772" width="2" height="6.36364" fill="currentColor" />
            </svg>
            Er is iets misgegaan
        </div>
        <div class="paragraph-heading">Let op!</div>
        <p>
            Tijdens het laden van Netherlands 3D is een fout opgetreden. Probeer het nogmaals of
            neem contact met ons op.
        </p>
    </div>

    <!-- ─────────────────────────────────────────────────────────────────── -->
    <!-- 7) UNITY LOADER SCRIPT & ALL CLIENT‐SIDE LOGIC                      -->
    <!-- ─────────────────────────────────────────────────────────────────── -->
    <script src="{{{ UNITY_LOADER_URL }}}"></script>
    <script>
      // ─── PARALLAX MOUSE‐MOVE LOGIC ───────────────────────────────────────
      (function() {
        const layers = {
          back:  document.getElementById('layer-back'),
          mid:   document.getElementById('layer-mid'),
          front: document.getElementById('layer-front')
        };
        const maxTranslate = { back: 0, mid: 20, front: 40 };

        window.addEventListener('mousemove', e => {
          const w  = window.innerWidth;
          const h  = window.innerHeight;
          const nx = (e.clientX / w) - 0.5;  // –0.5 .. +0.5
          const ny = (e.clientY / h) - 0.5;
          layers.back.style.transform  = `translate(0px, 0px)`;
          layers.mid.style.transform   = `translate(${-nx * maxTranslate.mid}px, ${-ny * maxTranslate.mid}px)`;
          layers.front.style.transform = `translate(${-nx * maxTranslate.front}px, ${-ny * maxTranslate.front}px)`;
        });
      })();

      // ─── MOBILE DETECTION + DEBUG PANEL LOGIC ───────────────────────────
      const md = new MobileDetect(window.navigator.userAgent);
      const isMobileDevice = md.mobile() !== null;

      let unityInstance; // Will hold the running Unity instance

      // Cache DOM references
      const loadingOverlay = document.getElementById('loadingOverlay');
      const progressBar     = document.getElementById('progressBar');
      const progressPercent = document.getElementById('progressPercent');
      const mobileWarning   = document.getElementById('unity-mobile-warning');
      const loadError       = document.getElementById('unity-load-error');
      const debugPanel      = document.getElementById('nl3d-debug');
      const onMobileBadge   = document.getElementById('nl3d-on-mobile');
      const uaBadge         = document.getElementById('nl3d-user-agent');
      const backButton      = document.getElementById('nl3d-back-button');

      function ShowDebugPanel() {
        const urlParams = new URLSearchParams(window.location.search);
        const debugMode = urlParams.get('debug') !== null;
        if (debugMode) {
          debugPanel.classList.add('--visible');
          onMobileBadge.innerText = isMobileDevice ? 'Yes' : 'No';
          uaBadge.innerText       = window.navigator.userAgent;
        }
      }

      function LoadUnity() {
        // 1) Hide the mobile‐warning (if it’s visible), then show our overlay
        mobileWarning.classList.remove('--visible');
        loadingOverlay.style.display = 'flex';

        // 2) Build URLs (Unity will replace the tokens at build time)
        const buildUrl  = 'Build';
        const config    = {
          dataUrl:            buildUrl + '/{{{ DATA_URL }}}',
          frameworkUrl:       buildUrl + '/{{{ FRAMEWORK_URL }}}',
          codeUrl:            buildUrl + '/{{{ CODE_URL }}}',
          streamingAssetsUrl: '{{{ STREAMING_ASSETS_URL }}}',
          companyName:        '{{{ COMPANY_NAME }}}',
          productName:        '{{{ PRODUCT_NAME }}}',
          productVersion:     '{{{ VERSION }}}'
        };
        if (isMobileDevice) {
          config.devicePixelRatio = 2;
        }

        // 3) Call createUnityInstance on #unityContainer
        createUnityInstance(
          document.querySelector('#unityContainer'),
          config,
          progress => {
            const pct = Math.round(progress * 100);
            progressBar.style.width       = pct + '%';
            progressPercent.innerText     = pct + '%';
            // When loading hits 100%, fade out the overlay & stop flipbook animation
            if (pct === 100) {
              loadingOverlay.classList.add('fadeOut');
              setTimeout(() => {
                loadingOverlay.style.display = 'none';
                document.getElementById('flipbookLogo').style.animation = 'none';
              }, 800);
            }
          }
        )
          .then(instance => {
            unityInstance = instance;
          })
          .catch(err => {
            // On any error during “createUnityInstance”, show the load-error dialog
            alert(err);
            loadError.classList.add('--visible');
          });
      }

      // 4) On page-load: show debug panel if “?debug”, then decide whether to load immediately
      ShowDebugPanel();
      if (isMobileDevice) {
        // On mobile: switch class so CSS can adjust (e.g. lower parallax resolution), then show warning
        document.body.classList.add('unity-mobile');
        mobileWarning.classList.add('--visible');
        backButton.classList.toggle('--visible', history.length > 2);
      } else {
        // On desktop or tablet: load Unity right away
        LoadUnity();
      }
    </script>
</body>
</html>
