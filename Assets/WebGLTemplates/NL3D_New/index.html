<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>{{{ PRODUCT_NAME }}}</title>
    <link rel="stylesheet" href="{{{ TEMPLATEDATA_PATH }}}style.css" />
</head>
<body>
    <!-- Parallax Layers -->
    <div id="parallaxContainer">
        <div class="parallax-layer" id="layer-back"></div>
        <div class="parallax-layer" id="layer-mid"></div>
        <div class="parallax-layer" id="layer-front"></div>
    </div>

    <!-- Loading Overlay Content -->
    <div id="loadingOverlay">
        <div id="overlayShade"></div>
        <div id="overlayContent">
            <!-- Flipbook Logo -->
            <div id="flipbookLogo"></div>

            <!-- Progress Bar -->
            <div id="progressContainer">
                <div id="progressBar"></div>
            </div>
            <p id="progressPercent">0%</p>
        </div>
    </div>

    <!-- Unity Canvas -->
    <div id="unityContainer"></div>

    <!-- Unity Loader Script -->
    <script src="{{{ UNITY_LOADER_URL }}}"></script>
    <script>
    // 1) Parallax Mouse‐Move Logic
    (function() {
      const layers = {
        back: document.getElementById('layer-back'),
        mid:  document.getElementById('layer-mid'),
        front:document.getElementById('layer-front')
      };
      const maxTranslate = { back: 10, mid: 20, front: 40 };

      window.addEventListener('mousemove', (e) => {
        const w = window.innerWidth;
        const h = window.innerHeight;
        const nx = (e.clientX / w) - 0.5;
        const ny = (e.clientY / h) - 0.5;

        layers.back.style.transform  = `translate(${ -nx * maxTranslate.back  }px, ${ -ny * maxTranslate.back  }px)`;
        layers.mid.style.transform   = `translate(${ -nx * maxTranslate.mid   }px, ${ -ny * maxTranslate.mid   }px)`;
        layers.front.style.transform = `translate(${ -nx * maxTranslate.front }px, ${ -ny * maxTranslate.front }px)`;
      });
    })();

    // 2) Unity Loading + Progress
    createUnityInstance(
      document.querySelector("#unityContainer"),
      {
        dataUrl:          "{{{ DATA_URL }}}",
        frameworkUrl:     "{{{ FRAMEWORK_URL }}}",
        codeUrl:          "{{{ CODE_URL }}}",
        streamingAssetsUrl: "{{{ STREAMING_ASSETS_URL }}}",
        companyName:      "{{{ COMPANY_NAME }}}",
        productName:      "{{{ PRODUCT_NAME }}}",
        productVersion:   "{{{ VERSION }}}"
      },
      (progress) => {
        const pct = Math.round(progress * 100);
        document.getElementById("progressBar").style.width = pct + "%";
        document.getElementById("progressPercent").innerText = pct + "%";
        if (pct === 100) {
          document.getElementById("loadingOverlay").classList.add("fadeOut");
          setTimeout(() => {
            document.getElementById("loadingOverlay").style.display = "none";
            // Optional: stop the flipbook animation
            document.getElementById("flipbookLogo").style.animation = "none";
          }, 800);
        }
      }
    );
    </script>
</body>
</html>